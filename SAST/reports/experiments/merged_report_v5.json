{
  "metadata": {
    "semgrep_file": "sast_results_v2.sarif",
    "bandit_file": "bandit_results.sarif",
    "generated_at": "2025-08-24T00:00:00Z"
  },
  "summary": {
    "total_findings": 41,
    "both_tools": 5,
    "semgrep_only": 30,
    "bandit_only": 6,
    "coverage": {
      "both_percentage": 12.195121951219512,
      "agreement_rate": 12.195121951219512
    }
  },
  "findings": {
    "both": [
      {
        "category": "both",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:218-218",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 218,
        "end_line": 218,
        "snippet": "            task = TS_Task(did=int(request.form['did']), title=request.form['title'], description=request.form['description'], private=eval(request.form['private']), uid1=current_user.id, uid2=-1)",
        "semgrep": {
          "rule_id": "rules.python-eval-exec-taint",
          "message": "Возможная инъекция кода: eval/exec с пользовательским вводом. Никогда не передавайте значения из request.* в eval/exec.\n",
          "severity": "LOW",
          "snippet": "            task = TS_Task(did=int(request.form['did']), title=request.form['title'], description=request.form['description'], private=eval(request.form['private']), uid1=current_user.id, uid2=-1)"
        },
        "bandit": {
          "rule_id": "B307",
          "message": "Use of possibly insecure function - consider using safer ast.literal_eval.",
          "severity": "LOW",
          "snippet": "            task = TS_Task(did=int(request.form['did']), title=request.form['title'], description=request.form['description'], private=eval(request.form['private']), uid1=current_user.id, uid2=-1)\n"
        }
      },
      {
        "category": "both",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/sconfig.py:3-3",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/sconfig.py",
        "start_line": 3,
        "end_line": 3,
        "snippet": "SECRET_KEY = 'CTF-2#SecretKey'",
        "semgrep": {
          "rule_id": "rules.flask-hardcoded-secrets",
          "message": "Захардкоженный секрет (CWE-798). Храните SECRET_KEY/JWT_KEY в переменных окружения или в секрет-хранилище.\n",
          "severity": "LOW",
          "snippet": "SECRET_KEY = 'CTF-2#SecretKey'"
        },
        "bandit": {
          "rule_id": "B105",
          "message": "Possible hardcoded password: 'CTF-2#SecretKey'",
          "severity": "LOW",
          "snippet": "SECRET_KEY = 'CTF-2#SecretKey'\n"
        }
      },
      {
        "category": "both",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:258-258",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 258,
        "end_line": 258,
        "snippet": "            if (len(request.form['title']) > 2 and type(int(request.form['did'])) == int and type(eval(request.form['private'])) == bool):",
        "semgrep": {
          "rule_id": "rules.python-eval-exec-taint",
          "message": "Возможная инъекция кода: eval/exec с пользовательским вводом. Никогда не передавайте значения из request.* в eval/exec.\n",
          "severity": "LOW",
          "snippet": "            if (len(request.form['title']) > 2 and type(int(request.form['did'])) == int and type(eval(request.form['private'])) == bool):"
        },
        "bandit": {
          "rule_id": "B307",
          "message": "Use of possibly insecure function - consider using safer ast.literal_eval.",
          "severity": "LOW",
          "snippet": "            if (len(request.form['title']) > 2 and type(int(request.form['did'])) == int and type(eval(request.form['private'])) == bool):\n"
        }
      },
      {
        "category": "both",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:217-217",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 217,
        "end_line": 217,
        "snippet": "        if (len(request.form['title']) > 2 and type(int(request.form['did'])) == int and type(eval(request.form['private'])) == bool):",
        "semgrep": {
          "rule_id": "rules.python-eval-exec-taint",
          "message": "Возможная инъекция кода: eval/exec с пользовательским вводом. Никогда не передавайте значения из request.* в eval/exec.\n",
          "severity": "LOW",
          "snippet": "        if (len(request.form['title']) > 2 and type(int(request.form['did'])) == int and type(eval(request.form['private'])) == bool):"
        },
        "bandit": {
          "rule_id": "B307",
          "message": "Use of possibly insecure function - consider using safer ast.literal_eval.",
          "severity": "LOW",
          "snippet": "        if (len(request.form['title']) > 2 and type(int(request.form['did'])) == int and type(eval(request.form['private'])) == bool):\n"
        }
      },
      {
        "category": "both",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:262-262",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 262,
        "end_line": 262,
        "snippet": "                task.private = eval(request.form['private'])",
        "semgrep": {
          "rule_id": "rules.python-eval-exec-taint",
          "message": "Возможная инъекция кода: eval/exec с пользовательским вводом. Никогда не передавайте значения из request.* в eval/exec.\n",
          "severity": "LOW",
          "snippet": "                task.private = eval(request.form['private'])"
        },
        "bandit": {
          "rule_id": "B307",
          "message": "Use of possibly insecure function - consider using safer ast.literal_eval.",
          "severity": "LOW",
          "snippet": "                task.private = eval(request.form['private'])\n"
        }
      }
    ],
    "semgrep": [
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:65-80",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 65,
        "end_line": 80,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что request.method не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if request.method == \"POST\":\n        ulogin = request.form['login']\n        upassword = request.form['password']\n        user = TS_User.query.filter_by(login=ulogin).first()\n        if user and check_password_hash(user.password, upassword):\n            login_user(user)\n            resp = make_response(redirect(url_for('myprofile')))\n            resp.set_cookie('rid', str(user.rid))\n            app.logger.info('[AUTH] [LOGIN] [Succeess] User:<%s>, role: <%s>', current_user.login, current_user.rid)\n            return resp\n        else:\n            flash('Login or password incorrect')\n            app.logger.warning('[AUTH] [LOGIN] [Failed] User:<%s> Password:<%s>', ulogin, upassword)\n            return redirect(url_for('login'))\n    else:\n        return render_template(\"login.html\")"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:398-399",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 398,
        "end_line": 399,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что rid не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "        if rid == 2:\n            tasks = TS_Task.query.filter(TS_Task.title.contains(tsearch)).order_by(TS_Task.date.desc()).all()"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/func.py:30-31",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/func.py",
        "start_line": 30,
        "end_line": 31,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что task.uid1 не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "        if task.uid1 == uid:\n            res = True"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:497-497",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 497,
        "end_line": 497,
        "rule_id": "rules.logging-passwords",
        "message": "Утечка чувствительных данных через логи (CWE-532): строка логирования содержит 'password'. Не логируйте пароли/секреты; маскируйте значения.\n",
        "severity": "LOW",
        "snippet": "            app.logger.warning('[AUTH] [admreg] [Failed] Please, enter other login or not null login or not null password')"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:216-232",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 216,
        "end_line": 232,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что request.method не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if request.method == \"POST\":\n        if (len(request.form['title']) > 2 and type(int(request.form['did'])) == int and type(eval(request.form['private'])) == bool):\n            task = TS_Task(did=int(request.form['did']), title=request.form['title'], description=request.form['description'], private=eval(request.form['private']), uid1=current_user.id, uid2=-1)\n            try:\n                db.session.add(task)\n                db.session.commit()\n                app.logger.info('[FUNC] [/taskcreate] [Succeess] User:<%s> Title:<%s> Description:<%s>',current_user.login, task.title, task.description)\n                return redirect(url_for('mytask'))\n            except:\n                app.logger.error('[FUNC] [/taskcreate] [Failed] User:<%s> Error DB insert',current_user.login)\n                flash('Error DB insert')\n                return redirect(url_for('mytask'))\n        else:\n            flash('Please, enter all rewuired data!')\n            return redirect(url_for('mytask'))\n    else:\n        return redirect(url_for('mytask'))"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:95-117",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 95,
        "end_line": 117,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что request.method не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if request.method == \"POST\":\n        ulogin=request.form['login']\n        upassword=request.form['password']\n        if not(ulogin or upassword):\n            flash('Please, fill fileds: login, password')\n            return redirect('/reg')\n        elif not(TS_User.query.filter_by(login=ulogin).first()) and ulogin and upassword:\n            user = TS_User(login=ulogin, password=generate_password_hash(upassword), email=request.form['email'], rid=0, token=\"\")\n            try:\n                db.session.add(user)\n                db.session.commit()\n                app.logger.info('[AUTH] [REG] [Succeess] User:<%s>', ulogin)\n                return redirect('/login')\n            except:\n                app.logger.error('[AUTH] [REG] [Failed] User:<%s>. Error DB insert.', ulogin)\n                flash('Error DB insert')\n                return redirect('/reg')\n        else:\n            app.logger.warning('[AUTH] [REG] [Failed] Please, enter other login or not null login or not null password')\n            flash('Please, enter other login or not null login or not null password')\n            return redirect('/reg')\n    else:\n        return render_template(\"reg.html\")"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:201-202",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 201,
        "end_line": 202,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что response.status_code не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if response.status_code == 401:\n        return redirect('/login')"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:77-77",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 77,
        "end_line": 77,
        "rule_id": "rules.logging-passwords",
        "message": "Утечка чувствительных данных через логи (CWE-532): строка логирования содержит 'password'. Не логируйте пароли/секреты; маскируйте значения.\n",
        "severity": "LOW",
        "snippet": "            app.logger.warning('[AUTH] [LOGIN] [Failed] User:<%s> Password:<%s>', ulogin, upassword)"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:423-429",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 423,
        "end_line": 429,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что len(users) не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "        if len(users) == 0:\n            reg = 1\n            app.logger.info('[FUNC] [/adminpanel] [Succeess] User:<%s> Role:<%d>/<%d> Start initialization >> Registration of a new captain for the service', current_user.login, current_user.rid, rid)\n            return render_template(\"admpanel.html\", users=users, rteam=rteam, reg=reg)\n        else:\n            app.logger.warning('[FUNC] [/adminpanel] [Failed] User:<%s> Access is denied', current_user.login)\n            return redirect(url_for('index'))"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/func.py:24-25",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/func.py",
        "start_line": 24,
        "end_line": 25,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что rid не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if rid == 2:\n        res = True"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/app.py:14-17",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/app.py",
        "start_line": 14,
        "end_line": 17,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что __name__ не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "if __name__ == '__main__':\n    with app.app_context():\n        db.create_all()\n        app.run()"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:174-174",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 174,
        "end_line": 174,
        "rule_id": "rules.logging-passwords",
        "message": "Утечка чувствительных данных через логи (CWE-532): строка логирования содержит 'password'. Не логируйте пароли/секреты; маскируйте значения.\n",
        "severity": "LOW",
        "snippet": "                app.logger.error('[AUTH] [passrec] [Failed] Token: <%s> incorrect. Not exist data. Password: <%s>', token, request.args.get('password'))"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/func.py:26-28",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/func.py",
        "start_line": 26,
        "end_line": 28,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что rid не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if rid == 1:\n        if task.private == False or (task.uid1 == uid and task.private == True):\n            res = True"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:186-186",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 186,
        "end_line": 186,
        "rule_id": "rules.logging-passwords",
        "message": "Утечка чувствительных данных через логи (CWE-532): строка логирования содержит 'password'. Не логируйте пароли/секреты; маскируйте значения.\n",
        "severity": "LOW",
        "snippet": "                        app.logger.info('[AUTH] [passrec] [Succeess] For User:<%s> change password', user.login)"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:305-306",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 305,
        "end_line": 306,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что rid не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if rid == 1:\n        tasks = TS_Task.query.filter(or_(TS_Task.private==False, and_(TS_Task.uid1==current_user.id, TS_Task.private==True))).order_by(TS_Task.tid.desc()).paginate(page=page, per_page=10)"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:113-113",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 113,
        "end_line": 113,
        "rule_id": "rules.logging-passwords",
        "message": "Утечка чувствительных данных через логи (CWE-532): строка логирования содержит 'password'. Не логируйте пароли/секреты; маскируйте значения.\n",
        "severity": "LOW",
        "snippet": "            app.logger.warning('[AUTH] [REG] [Failed] Please, enter other login or not null login or not null password')"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:257-275",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 257,
        "end_line": 275,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что request.method не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "        if request.method == \"POST\":\n            if (len(request.form['title']) > 2 and type(int(request.form['did'])) == int and type(eval(request.form['private'])) == bool):\n                task.title = request.form['title']\n                task.description = request.form['description']\n                task.did = int(request.form['did'])\n                task.private = eval(request.form['private'])\n                try:\n                    db.session.commit()\n                    app.logger.info('[FUNC] [/task/edit] [Succeess] User:<%s> Edit task: <%s> owner:<%s>', current_user.login, task.tid, task.TS_User.login)\n                    return redirect(url_for('mytask'))\n                except:\n                    app.logger.error('[FUNC] [/task/edit] [Failed] User:<%s> Edit task: <%s> owner:<%s>. Error DB insert/', current_user.login, task.tid, task.TS_User.login)\n                    flash('Error DB insert')\n                    return redirect('/task/' + str(tid) + '/edit')\n            else:\n                flash('Please, enter all rewuired data!')\n                return redirect('/task/' + str(tid) + '/edit')\n        else:\n            return render_template(\"task_edit.html\", task=task, desteam=desteam)"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/func.py:37-37",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/func.py",
        "start_line": 37,
        "end_line": 37,
        "rule_id": "rules.jwt-encode-without-exp-claim",
        "message": "CWE-640 (эвристика): jwt.encode() без поля exp в payload. Добавьте 'exp' и проверяйте истечение срока.\n",
        "severity": "LOW",
        "snippet": "    token = jwt.encode(jwt_data, JWT_KEY, algorithm=\"HS256\")"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:400-401",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 400,
        "end_line": 401,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что rid не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "        if rid == 1:\n            tasks = TS_Task.query.filter(and_(or_(TS_Task.private==False, and_(TS_Task.uid1==current_user.id, TS_Task.private==True)), TS_Task.title.contains(tsearch))).order_by(TS_Task.date.desc()).all()"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:416-429",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 416,
        "end_line": 429,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что rid не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if rid == 2:\n        users = TS_User.query.order_by(TS_User.id.desc()).paginate(page=page, per_page=10)\n        pagination = Pagination(page=page, total=users.total, record_name='users')\n        app.logger.info('[FUNC] [/adminpanel] [Succeess] User:<%s> Role:<%d>/<%d> Read users: <%d>', current_user.login, current_user.rid, rid, len(users.items))\n        return render_template(\"admpanel.html\", users=users, rteam=rteam, reg=reg, pagination=pagination)\n    else:\n        users = TS_User.query.filter(TS_User.rid==2).order_by(TS_User.id.desc()).all()\n        if len(users) == 0:\n            reg = 1\n            app.logger.info('[FUNC] [/adminpanel] [Succeess] User:<%s> Role:<%d>/<%d> Start initialization >> Registration of a new captain for the service', current_user.login, current_user.rid, rid)\n            return render_template(\"admpanel.html\", users=users, rteam=rteam, reg=reg)\n        else:\n            app.logger.warning('[FUNC] [/adminpanel] [Failed] User:<%s> Access is denied', current_user.login)\n            return redirect(url_for('index'))"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:303-304",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 303,
        "end_line": 304,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что rid не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if rid == 2:\n        tasks = TS_Task.query.order_by(TS_Task.tid.desc()).paginate(page=page, per_page=10)"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:120-196",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 120,
        "end_line": 196,
        "rule_id": "rules.flask-passrec-get-route-password-change",
        "message": "CWE-640 (эвристика): маршрут допускает метод GET и меняет пароль. Смена пароля по GET небезопасна. Используйте POST и проверяйте токен/TTL/одноразовость.\n",
        "severity": "LOW",
        "snippet": "@app.route('/passrec', methods=['POST','GET'])\ndef passrec():\n    p = 0\n    token = \"\"\n    if len(request.args) > 0:\n        if request.args.get('login'):\n            ulogin = request.args.get('login')\n            user = TS_User.query.filter(TS_User.login==ulogin).first()\n            if user:\n                token = jwt_encod(user)\n                user.token = token\n                try:\n                    db.session.add(user)\n                    db.session.commit()\n                    flash('Token created...')\n                    app.logger.info('[AUTH] [passrec] [Succeess] For User:<%s> token <%s> created', ulogin, token)\n                except:\n                    app.logger.error('[AUTH] [passrec] [Failed] User:<%s>. Error DB insert.', ulogin)\n                    flash('Error DB insert')\n            else:\n                flash('Login incorrect')\n                app.logger.warning('[AUTH] [passrec] [Failed] User:<%s> does not exist', ulogin)\n        if request.args.get('token') and not request.args.get('password'):\n            token = request.args.get('token')\n            try:\n                token_data = jwt_decod(token)\n                app.logger.info('[AUTH] [passrec] [Succeess] For token: <%s> exist data: <%s>', token, token_data)\n            except:\n                p = 0\n                token_data = \"\"\n                flash('Token incorrect')\n                app.logger.error('[AUTH] [passrec] [Failed] Token: <%s> incorrect', token)\n            if token_data:\n                uid = token_data[\"id\"]\n                user = TS_User.query.filter(TS_User.id==uid).first()\n                if user:\n                    p = 1\n                    app.logger.info('[AUTH] [passrec] [Succeess] For token: <%s> exist user: <%s>', token, user.login)\n                    return render_template(\"recpass.html\", p=p, token=token)\n                else:\n                    p = 0\n                    flash('Token incorrect')\n                    app.logger.error('[AUTH] [passrec] [Failed] Token: <%s> incorrect. Not exist user.', token)\n            else:\n                p = 0\n                app.logger.error('[AUTH] [passrec] [Failed] Token: <%s> incorrect. Not exist data.', token)\n                flash('Token incorrect')\n        if request.args.get('token') and request.args.get('password'):\n            token = request.args.get('token')\n            try:\n                token_data = jwt_decod(token)\n            except:\n                p = 0\n                token_data = \"\"\n                app.logger.error('[AUTH] [passrec] [Failed] Token: <%s> incorrect. Not exist data. Password: <%s>', token, request.args.get('password'))\n                flash('Token incorrect')\n            if token_data:\n                uid = token_data[\"id\"]\n                user = TS_User.query.filter(TS_User.id==uid).first()\n                if user:\n                    p = 0\n                    user.password = generate_password_hash(request.args.get('password'))\n                    user.token = \"\"\n                    try:\n                        db.session.add(user)\n                        db.session.commit()\n                        app.logger.info('[AUTH] [passrec] [Succeess] For User:<%s> change password', user.login)\n                    except:\n                        app.logger.error('[AUTH] [passrec] [Failed] User:<%s>. Error DB insert.', user.login)\n                        flash('Error DB insert')\n            else:\n                p = 0\n                flash('Token incorrect')\n                app.logger.error('[AUTH] [passrec] [Failed] Token: <%s> incorrect. Not exist data.', token)\n    else:\n        pass\n    return render_template(\"recpass.html\", p=p, token=token)"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:402-403",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 402,
        "end_line": 403,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что rid не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "        if rid == 0:\n            tasks = TS_Task.query.filter(and_(TS_Task.uid1==current_user.id, TS_Task.title.contains(tsearch))).order_by(TS_Task.date.desc()).all()"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:307-308",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 307,
        "end_line": 308,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что rid не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if rid == 0:\n        tasks = TS_Task.query.filter(TS_Task.uid1==current_user.id).order_by(TS_Task.tid.desc()).paginate(page=page, per_page=10)"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:436-451",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 436,
        "end_line": 451,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что rid не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if rid == 2:\n        user = TS_User.query.filter(TS_User.id==id).order_by(TS_User.date.desc()).first()\n        if user:\n            if user.rid != 2:\n                user.rid += 1\n                try:\n                    db.session.commit()\n                    app.logger.info('[FUNC] [/adminpanel/nrteam] [Succeess] User:<%s> Role:<%d>/<%d> For user:<%s> upd role to:<%d>', current_user.login, current_user.rid, rid, user.login, user.rid)\n                except:\n                    app.logger.error('[FUNC] [/adminpanel/nrteam] [Succeess] User:<%s> Role:<%d> For user:<%s> upd role to:<%d>. Error DB delete!', current_user.login, current_user.rid, user.login, user.rid)\n                    return \"Error DB delete!\"\n        else:\n            app.logger.warning('[FUNC] [/adminpanel/nrteam] [Failed] User:<%s> Role:<%d> For user:<%s> upd role to:<%d> User not found!', current_user.login, current_user.rid, user.login, user.rid)\n        return redirect(url_for('adm'))\n    else:\n        redirect(url_for('index'))"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/sconfig.py:4-4",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/sconfig.py",
        "start_line": 4,
        "end_line": 4,
        "rule_id": "rules.flask-hardcoded-secrets",
        "message": "Захардкоженный секрет (CWE-798). Храните SECRET_KEY/JWT_KEY в переменных окружения или в секрет-хранилище.\n",
        "severity": "LOW",
        "snippet": "JWT_KEY = 'CTF-2#PirateLabel'"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/func.py:29-31",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/func.py",
        "start_line": 29,
        "end_line": 31,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что rid не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if rid == 0:\n        if task.uid1 == uid:\n            res = True"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:405-405",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 405,
        "end_line": 405,
        "rule_id": "rules.flask-ssti-render-template-string-taint",
        "message": "Возможная SSTI (CWE-1336): пользовательский ввод попадает в render_template_string(). Проверьте, что строка не формируется из request.args/request.form/request.values/JSON.\n",
        "severity": "LOW",
        "snippet": "        return render_template(\"searchlist.html\", tasks=tasks, tstatus=tstatus, tsearch=render_template_string(tsearch))"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:479-501",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 479,
        "end_line": 501,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что request.method не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if request.method == \"POST\":\n        ulogin=request.form['login']\n        upassword=request.form['password']\n        if not(ulogin or upassword):\n            flash('Please, fill fileds: login, password')\n            return redirect(url_for('adm'))\n        elif not(TS_User.query.filter_by(login=ulogin).first()) and ulogin and upassword:\n            user = TS_User(login=ulogin, password=generate_password_hash(upassword), email=request.form['email'], rid=2, token=\"\")\n            try:\n                db.session.add(user)\n                db.session.commit()\n                app.logger.info('[AUTH] [admreg] [Succeess] User:<%s> Role:<%d> registartion captain:<%s>',current_user.login, current_user.rid, ulogin)\n                return redirect(url_for('adm'))\n            except:\n                app.logger.error('[AUTH] [admreg] [Failed] User:<%s>. Error DB insert.', ulogin)\n                flash('Error DB insert')\n                return redirect(url_for('adm'))\n        else:\n            app.logger.warning('[AUTH] [admreg] [Failed] Please, enter other login or not null login or not null password')\n            flash('Please, enter other login or not null login or not null password')\n            return redirect(url_for('adm'))\n    else:\n        redirect(url_for('index'))"
      },
      {
        "category": "semgrep",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:458-473",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 458,
        "end_line": 473,
        "rule_id": "rules.flask-privilege-magic-role-check",
        "message": "Эвристика CWE-269: жёсткая проверка роли по «магическому числу/строке». Убедитесь, что rid не приходит из cookie, и что проверка выполняется на серверной роли (current_user / серверная сессия).\n",
        "severity": "LOW",
        "snippet": "    if rid == 2:\n        user = TS_User.query.filter(TS_User.id==id).order_by(TS_User.date.desc()).first()\n        if user:\n            if user.rid != 0:\n                user.rid -= 1\n                try:\n                    db.session.commit()\n                    app.logger.info('[FUNC] [/adminpanel/brteam] [Succeess] User:<%s> Role:<%d>/<%d> For user:<%s> upd role to:<%d>', current_user.login, current_user.rid, rid, user.login, user.rid)\n                except:\n                    app.logger.error('[FUNC] [/adminpanel/brteam] [Succeess] User:<%s> Role:<%d> For user:<%s> upd role to:<%d>. Error DB delete!', current_user.login, current_user.rid, user.login, user.rid)\n                    return \"Error DB delete!\"\n        else:\n            app.logger.warning('[FUNC] [/adminpanel/brteam] [Failed] User:<%s> Role:<%d> For user:<%s> upd role to:<%d> User not found!', current_user.login, current_user.rid, user.login, user.rid)\n        return redirect(url_for('adm'))\n    else:\n        redirect(url_for('index'))"
      }
    ],
    "bandit": [
      {
        "category": "bandit",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:102-102",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 102,
        "end_line": 102,
        "rule_id": "B106",
        "message": "Possible hardcoded password: ''",
        "severity": "LOW",
        "snippet": "            user = TS_User(login=ulogin, password=generate_password_hash(upassword), email=request.form['email'], rid=0, token=\"\")\n"
      },
      {
        "category": "bandit",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:486-486",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 486,
        "end_line": 486,
        "rule_id": "B106",
        "message": "Possible hardcoded password: ''",
        "severity": "LOW",
        "snippet": "            user = TS_User(login=ulogin, password=generate_password_hash(upassword), email=request.form['email'], rid=2, token=\"\")\n"
      },
      {
        "category": "bandit",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:149-149",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 149,
        "end_line": 149,
        "rule_id": "B105",
        "message": "Possible hardcoded password: ''",
        "severity": "LOW",
        "snippet": "                token_data = \"\"\n"
      },
      {
        "category": "bandit",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:123-123",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 123,
        "end_line": 123,
        "rule_id": "B105",
        "message": "Possible hardcoded password: ''",
        "severity": "LOW",
        "snippet": "    token = \"\"\n"
      },
      {
        "category": "bandit",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:182-182",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 182,
        "end_line": 182,
        "rule_id": "B105",
        "message": "Possible hardcoded password: ''",
        "severity": "LOW",
        "snippet": "                    user.token = \"\"\n"
      },
      {
        "category": "bandit",
        "location_key": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py:173-173",
        "file_path": "/Users/izelikson/python/CryptoSlon/SAST/taskstate/tsapp/routes.py",
        "start_line": 173,
        "end_line": 173,
        "rule_id": "B105",
        "message": "Possible hardcoded password: ''",
        "severity": "LOW",
        "snippet": "                token_data = \"\"\n"
      }
    ]
  }
}