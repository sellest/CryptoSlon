{
  "result": [
    {
      "атрибуты": "CWE-269 Improper Privilege Management",
      "Название": "Неправильное управление привилегиями в маршрутах",
      "CWE": "CWE-269 Improper Privilege Management",
      "Риск": "HIGH – множество (21) мест без корректных проверок доступа позволяет горизонтальную/вертикальную эскалацию привилегий.",
      "Почему это важно": "Атакер может выполнять админские операции или читать/менять чужие данные, обходя аутентификацию/авторизацию. Это ведёт к полной компрометации данных и нарушению моделей доступа в проде. Масштаб охвата (несколько блоков кода) повышает вероятность эксплуатации.",
      "PoC": "Обратиться к одному из эндпоинтов с админ‑функцией без токена/сессии (см. routes.py:416-451) и получить 200/успешный результат; либо вручную изменить роль/идентификатор в запросе/сессии и вызвать операции изменения ролей (routes.py:458-473).",
      "Fix": "Явно внедрить декораторы @login_required/@roles_required и централизованные проверки ACL перед любыми чувствительными действиями; добавить unit/integ‑тесты на отказ без привилегий.",
      "Representative evidence": [
        {
          "location": "/taskstate/tsapp/routes.py:416-429",
          "snippet": "Административная операция до выполнения не сопровождается проверкой роли/сессии (Semgrep: missing authZ check)."
        },
        {
          "location": "/taskstate/tsapp/routes.py:436-451",
          "snippet": "Мутация пользовательских записей/ролей без явной проверки прав (Semgrep finding)."
        },
        {
          "location": "/taskstate/app.py:14-17",
          "snippet": "Глобальная конфигурация/инициализация без включённых проверок может приводить к обходу (Semgrep flagged pattern)."
        }
      ],
      "Источник": "semgrep"
    },
    {
      "атрибуты": "CWE-95 Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')",
      "Название": "Code Injection через eval/exec",
      "CWE": "CWE-95 Code Injection via eval/exec",
      "Риск": "HIGH – выполнение произвольного кода через eval/exec ведёт к RCE и полному захвату сервера.",
      "Почему это важно": "Одной строки с eval/exec на непроверенном вводе достаточно, чтобы атакер исполнил системные команды. Это напрямую угрожает данным, секретам и инфраструктуре.",
      "PoC": "Передать в параметр, который попадает в eval/exec, значение: __import__('os').system('id') и получить выполнение команды (см. routes.py:217,218,258,262).",
      "Fix": "Убрать eval/exec; заменить на безопасные парсеры/вайтлисты, использовать явное сопоставление операций и типов данных.",
      "Representative evidence": [
        {
          "location": "/taskstate/tsapp/routes.py:217-218",
          "snippet": "Вызов eval(...) над данными из запроса (Semgrep/Bandit: dangerous eval)."
        },
        {
          "location": "/taskstate/tsapp/routes.py:258-262",
          "snippet": "Выполнение кода/выражений, сформированных из пользовательского ввода (Semgrep/Bandit finding)."
        }
      ],
      "Источник": "both"
    },
    {
      "атрибуты": "CWE-640 Weak Password Recovery Mechanism for Forgotten Password",
      "Название": "Слабый механизм восстановления пароля",
      "CWE": "CWE-640 Weak Password Recovery",
      "Риск": "HIGH – позволяет перехватить/сбросить пароль жертвы через предсказуемый/несекурный токен или без достаточной верификации.",
      "Почему это важно": "Компрометация процесса восстановления часто эквивалентна компрометации всей учётной записи. Атакер может получить доступ без взлома основного пароля и закрепиться в системе.",
      "PoC": "Инициировать восстановление и перебрать/предсказать код/токен подтверждения из ограниченного пространства (см. routes.py:120-196; func.py:37). Отсутствие rate‑limit/подтверждения e‑mail упрощает атаку.",
      "Fix": "Использовать криптографически стойкие одноразовые токены с истечением, связывать их с устройством/почтой, вводить rate‑limit и обязательную повторную аутентификацию.",
      "Representative evidence": [
        {
          "location": "/taskstate/tsapp/routes.py:120-196",
          "snippet": "Логика reset/forgot без надлежащих проверок и ограничений (Semgrep: weak recovery flow)."
        },
        {
          "location": "/taskstate/tsapp/func.py:37-37",
          "snippet": "Генерация/проверка токена восстановления отмечена как уязвимая (Semgrep finding)."
        }
      ],
      "Источник": "semgrep"
    },
    {
      "атрибуты": "CWE-1336 Improper Neutralization of Special Elements Used in a Template Engine",
      "Название": "Server-Side Template Injection (SSTI)",
      "CWE": "CWE-1336 SSTI",
      "Риск": "HIGH – SSTI часто эскалирует до RCE через доступ к объектам/OS.",
      "Почему это важно": "Шаблонизатор с пользовательским вводом позволяет выполнить выражения и получить доступ к секретам и файловой системе. Это прямой путь к компрометации приложения и окружения.",
      "PoC": "Передать {{7*7}} в поле/параметр, который шаблон отрисовывает напрямую (см. routes.py:405). В ответе появится 49; далее возможна эскалация к RCE.",
      "Fix": "Никогда не передавать непроверенный ввод в render_template_string; экранировать данные, включить sandbox/jinja2.StrictUndefined и использовать белые списки полей.",
      "Representative evidence": [
        {
          "location": "/taskstate/tsapp/routes.py:405-405",
          "snippet": "Рендеринг шаблона с несанитизированным вводом (Semgrep: render_template_string/format)."
        }
      ],
      "Источник": "semgrep"
    },
    {
      "атрибуты": "CWE-798/259 Use of Hard-coded Credentials/Passwords",
      "Название": "Хардкоды секретов и паролей в коде",
      "CWE": "CWE-798/259 Hard-coded Credentials/Passwords",
      "Риск": "MEDIUM – утечка ключей/паролей ведёт к несанкционированному доступу; в проде риск фактически HIGH.",
      "Почему это важно": "Секреты в репозитории попадают в логи/артефакты и могут использоваться для входа, доступа к БД или внешним API. Это облегчает lateral movement и затрудняет ротацию ключей.",
      "PoC": "Найти значения в коде (routes.py:102,123,149,173,182,486; sconfig.py:3-4) и использовать для аутентификации/подключения к сервисам.",
      "Fix": "Удалить секреты из кода; хранить в переменных окружения/secret manager, внедрить ротацию и детектирование утечек в CI.",
      "Representative evidence": [
        {
          "location": "/taskstate/tsapp/sconfig.py:3-4",
          "snippet": "Константы/ключи заданы прямо в исходниках (Bandit/Semgrep: hardcoded secret)."
        },
        {
          "location": "/taskstate/tsapp/routes.py:102-102",
          "snippet": "Хардкод пароля/токена внутри обработчика (Semgrep/Bandit finding)."
        }
      ],
      "Источник": "both",
      "Примечание": "Сопутствующая уязвимость: CWE-532 (Sensitive Data in Logs) замечена в routes.py:77,113,174,186,497 и усиливает риск утечки секретов."
    }
  ],
  "verdict": "Итог: 5 корневых уязвимостей. Подтверждены обоими инструментами: Code Injection (CWE-95), Hard-coded Secrets (CWE-798/259). Обнаружены только Semgrep: Improper Privilege Management (CWE-269), Weak Password Recovery (CWE-640), SSTI (CWE-1336). Всего в отчёте 42 срабатывания (28 HIGH, 14 MEDIUM); чувствительная информация в логах (CWE-532) выступает как сопутствующий фактор усиления риска.",
  "metadata": {
    "model": "gpt-5",
    "template": "sast",
    "source_report": "../SAST/aggregated_sast_report_semantic_v1.json",
    "is_json": true
  }
}