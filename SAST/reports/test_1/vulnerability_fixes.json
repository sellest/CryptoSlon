{
  "metadata": {
    "source_report": "/Users/izelikson/python/CryptoSlon/SAST/reports/first_test/vulnerability_snippets.json",
    "model": "gpt-5-mini",
    "template": "vulnerability_fix",
    "generated_at": "2025-08-24T00:00:00Z",
    "total_fixes": 3
  },
  "fixes": [
    {
      "vulnerability_info": {
        "type": "Code Injection через eval/exec",
        "cwe": "CWE-95",
        "file": "/taskstate/tsapp/routes.py",
        "location": "217-217",
        "severity": "HIGH"
      },
      "original_code": " 214     @login_required\n 215     def taskcreate():\n 216         if request.method == \"POST\":\n 217 >>>         if (len(request.form['title']) > 2 and type(int(request.form['did'])) == int and type(eval(request.form['private'])) == bool):\n 218                 task = TS_Task(did=int(request.form['did']), title=request.form['title'], description=request.form['description'], private=eval(request.form['private']), uid1=current_user.id, uid2=-1)\n 219                 try:\n 220                     db.session.add(task)",
      "suggested_fix": "Убрать eval/exec; заменить на безопасные парсеры/вайтлисты, использовать явное сопоставление операций и типов данных.",
      "llm_fixed_code": "@login_required\ndef taskcreate():\n    if request.method == \"POST\":\n        title = (request.form.get('title') or \"\").strip()\n        did_raw = (request.form.get('did') or \"\").strip()\n        private_raw = (request.form.get('private') or \"\").strip().lower()\n        description = request.form.get('description', '')\n\n        # Validate title length\n        if len(title) <= 2:\n            return  # or handle invalid input appropriately\n\n        # Validate and parse did as integer\n        try:\n            did = int(did_raw)\n        except (ValueError, TypeError):\n            return  # or handle invalid input appropriately\n\n        # Explicitly map allowed boolean representations to bool\n        true_set = {'true', '1', 'yes', 'y', 'on'}\n        false_set = {'false', '0', 'no', 'n', 'off', ''}\n        if private_raw in true_set:\n            private = True\n        elif private_raw in false_set:\n            private = False\n        else:\n            return  # or handle invalid input appropriately\n\n        task = TS_Task(did=did, title=title, description=description, private=private, uid1=current_user.id, uid2=-1)\n        try:\n            db.session.add(task)\n        except Exception:\n            db.session.rollback()\n            raise",
      "llm_response_raw": "@login_required\ndef taskcreate():\n    if request.method == \"POST\":\n        title = (request.form.get('title') or \"\").strip()\n        did_raw = (request.form.get('did') or \"\").strip()\n        private_raw = (request.form.get('private') or \"\").strip().lower()\n        description = request.form.get('description', '')\n\n        # Validate title length\n        if len(title) <= 2:\n            return  # or handle invalid input appropriately\n\n        # Validate and parse did as integer\n        try:\n            did = int(did_raw)\n        except (ValueError, TypeError):\n            return  # or handle invalid input appropriately\n\n        # Explicitly map allowed boolean representations to bool\n        true_set = {'true', '1', 'yes', 'y', 'on'}\n        false_set = {'false', '0', 'no', 'n', 'off', ''}\n        if private_raw in true_set:\n            private = True\n        elif private_raw in false_set:\n            private = False\n        else:\n            return  # or handle invalid input appropriately\n\n        task = TS_Task(did=did, title=title, description=description, private=private, uid1=current_user.id, uid2=-1)\n        try:\n            db.session.add(task)\n        except Exception:\n            db.session.rollback()\n            raise",
      "model_used": "gpt-5-mini"
    },
    {
      "vulnerability_info": {
        "type": "Code Injection через eval/exec",
        "cwe": "CWE-95",
        "file": "/taskstate/tsapp/routes.py",
        "location": "218-218",
        "severity": "HIGH"
      },
      "original_code": " 215     def taskcreate():\n 216         if request.method == \"POST\":\n 217             if (len(request.form['title']) > 2 and type(int(request.form['did'])) == int and type(eval(request.form['private'])) == bool):\n 218 >>>             task = TS_Task(did=int(request.form['did']), title=request.form['title'], description=request.form['description'], private=eval(request.form['private']), uid1=current_user.id, uid2=-1)\n 219                 try:\n 220                     db.session.add(task)\n 221                     db.session.commit()",
      "suggested_fix": "Убрать eval/exec; заменить на безопасные парсеры/вайтлисты, использовать явное сопоставление операций и типов данных.",
      "llm_fixed_code": "def taskcreate():\n    from flask import abort\n    import ast\n\n    if request.method == \"POST\":\n        title = request.form.get('title', '').strip()\n        did_raw = request.form.get('did', '').strip()\n        private_raw = request.form.get('private', '').strip()\n        description = request.form.get('description', '').strip()\n\n        # Validate title\n        if len(title) <= 2:\n            return abort(400)\n\n        # Validate and parse did as integer\n        try:\n            did = int(did_raw)\n        except (ValueError, TypeError):\n            return abort(400)\n\n        # Parse boolean safely using whitelist and ast.literal_eval as fallback\n        private_lower = private_raw.lower()\n        if private_lower in ('true', '1', 'yes', 'y'):\n            private = True\n        elif private_lower in ('false', '0', 'no', 'n'):\n            private = False\n        else:\n            try:\n                parsed = ast.literal_eval(private_raw)\n                if isinstance(parsed, bool):\n                    private = parsed\n                else:\n                    return abort(400)\n            except Exception:\n                return abort(400)\n\n        task = TS_Task(did=did, title=title, description=description, private=private, uid1=current_user.id, uid2=-1)\n        try:\n            db.session.add(task)\n            db.session.commit()\n        except Exception:\n            db.session.rollback()\n            return abort(500)",
      "llm_response_raw": "def taskcreate():\n    from flask import abort\n    import ast\n\n    if request.method == \"POST\":\n        title = request.form.get('title', '').strip()\n        did_raw = request.form.get('did', '').strip()\n        private_raw = request.form.get('private', '').strip()\n        description = request.form.get('description', '').strip()\n\n        # Validate title\n        if len(title) <= 2:\n            return abort(400)\n\n        # Validate and parse did as integer\n        try:\n            did = int(did_raw)\n        except (ValueError, TypeError):\n            return abort(400)\n\n        # Parse boolean safely using whitelist and ast.literal_eval as fallback\n        private_lower = private_raw.lower()\n        if private_lower in ('true', '1', 'yes', 'y'):\n            private = True\n        elif private_lower in ('false', '0', 'no', 'n'):\n            private = False\n        else:\n            try:\n                parsed = ast.literal_eval(private_raw)\n                if isinstance(parsed, bool):\n                    private = parsed\n                else:\n                    return abort(400)\n            except Exception:\n                return abort(400)\n\n        task = TS_Task(did=did, title=title, description=description, private=private, uid1=current_user.id, uid2=-1)\n        try:\n            db.session.add(task)\n            db.session.commit()\n        except Exception:\n            db.session.rollback()\n            return abort(500)",
      "model_used": "gpt-5-mini"
    },
    {
      "vulnerability_info": {
        "type": "Code Injection через eval/exec",
        "cwe": "CWE-95",
        "file": "/taskstate/tsapp/routes.py",
        "location": "258-258",
        "severity": "HIGH"
      },
      "original_code": " 255         task = TS_Task.query.filter(and_(TS_Task.uid1==current_user.id, TS_Task.tid==tid)).order_by(TS_Task.date.desc()).first()\n 256         if task:\n 257             if request.method == \"POST\":\n 258 >>>             if (len(request.form['title']) > 2 and type(int(request.form['did'])) == int and type(eval(request.form['private'])) == bool):\n 259                     task.title = request.form['title']\n 260                     task.description = request.form['description']\n 261                     task.did = int(request.form['did'])",
      "suggested_fix": "Убрать eval/exec; заменить на безопасные парсеры/вайтлисты, использовать явное сопоставление операций и типов данных.",
      "llm_fixed_code": "task = TS_Task.query.filter(and_(TS_Task.uid1==current_user.id, TS_Task.tid==tid)).order_by(TS_Task.date.desc()).first()\n        if task:\n            if request.method == \"POST\":\n                title = (request.form.get('title') or '').strip()\n                did_raw = (request.form.get('did') or '').strip()\n                private_raw = (request.form.get('private') or '').strip().lower()\n                # validate title\n                if len(title) > 2:\n                    # validate did as integer\n                    try:\n                        did_val = int(did_raw)\n                    except (ValueError, TypeError):\n                        did_val = None\n                    # safe boolean parsing for 'private'\n                    if private_raw in ('1', 'true', 'yes', 'on'):\n                        private_val = True\n                    elif private_raw in ('0', 'false', 'no', 'off'):\n                        private_val = False\n                    else:\n                        private_val = None\n                    if did_val is not None and isinstance(private_val, bool):\n                        task.title = title\n                        task.description = request.form.get('description', '')\n                        task.did = did_val\n                        task.private = private_val",
      "llm_response_raw": "        task = TS_Task.query.filter(and_(TS_Task.uid1==current_user.id, TS_Task.tid==tid)).order_by(TS_Task.date.desc()).first()\n        if task:\n            if request.method == \"POST\":\n                title = (request.form.get('title') or '').strip()\n                did_raw = (request.form.get('did') or '').strip()\n                private_raw = (request.form.get('private') or '').strip().lower()\n                # validate title\n                if len(title) > 2:\n                    # validate did as integer\n                    try:\n                        did_val = int(did_raw)\n                    except (ValueError, TypeError):\n                        did_val = None\n                    # safe boolean parsing for 'private'\n                    if private_raw in ('1', 'true', 'yes', 'on'):\n                        private_val = True\n                    elif private_raw in ('0', 'false', 'no', 'off'):\n                        private_val = False\n                    else:\n                        private_val = None\n                    if did_val is not None and isinstance(private_val, bool):\n                        task.title = title\n                        task.description = request.form.get('description', '')\n                        task.did = did_val\n                        task.private = private_val",
      "model_used": "gpt-5-mini"
    }
  ]
}