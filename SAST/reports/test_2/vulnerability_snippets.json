{
  "metadata": {
    "source_report": "/Users/izelikson/python/CryptoSlon/SAST/reports/second_test/triage_analysis.json",
    "code_base_path": "/Users/izelikson/python/CryptoSlon/SAST/code_for_sast/taskstate_copy/",
    "generated_at": "2025-08-24T00:00:00Z",
    "total_snippets": 5
  },
  "vulnerabilities": [
    {
      "vulnerability": "Improper Privilege Management (multiple endpoints)",
      "file": "/taskstate_copy/app.py",
      "location": "14-17",
      "original": "   9         with app.app_context():\n  10             db.create_all()\n  11             app.logger.info('[INIT] [DB] [Succeess] DB create <%s>', app.config['SQLALCHEMY_DATABASE_URI'])\n  12             time.sleep(3)\n  13     \n  14 >>> if __name__ == '__main__':\n  15 >>>     with app.app_context():\n  16 >>>         db.create_all()\n  17 >>>         app.run()",
      "suggested_fix": "Внедрить строгую авторизацию на каждом защищённом действии (декораторы/мидлвары), принцип deny-by-default и проверку роли/владельца ресурса.",
      "poc": "Войти как обычный пользователь. Обратиться к админ-функции без валидной роли/токена и проверить успешное выполнение действия (HTTP 200) на защищённой операции.",
      "risk": "HIGH: 5 срабатываний HIGH, подтверждено SAST. Возможна эскалация до админа.",
      "severity": "HIGH",
      "cwe": "CWE-269 Improper Privilege Management",
      "sources": [
        "semgrep"
      ]
    },
    {
      "vulnerability": "Improper Privilege Management (multiple endpoints)",
      "file": "/taskstate_copy/tsapp/func.py",
      "location": "29-31",
      "original": "  24         if rid == 2:\n  25             res = True\n  26         if rid == 1:\n  27             if task.private == False or (task.uid1 == uid and task.private == True):\n  28                 res = True\n  29 >>>     if rid == 0:\n  30 >>>         if task.uid1 == uid:\n  31 >>>             res = True\n  32         return res\n  33     \n  34     \n  35     def jwt_encod(user):\n  36         jwt_data = {\"id\": user.id,\"login\": user.login}",
      "suggested_fix": "Внедрить строгую авторизацию на каждом защищённом действии (декораторы/мидлвары), принцип deny-by-default и проверку роли/владельца ресурса.",
      "poc": "Войти как обычный пользователь. Обратиться к админ-функции без валидной роли/токена и проверить успешное выполнение действия (HTTP 200) на защищённой операции.",
      "risk": "HIGH: 5 срабатываний HIGH, подтверждено SAST. Возможна эскалация до админа.",
      "severity": "HIGH",
      "cwe": "CWE-269 Improper Privilege Management",
      "sources": [
        "semgrep"
      ]
    },
    {
      "vulnerability": "Weak Password Recovery Mechanism",
      "file": "/taskstate_copy/tsapp/func.py",
      "location": "37-37",
      "original": "  32         return res\n  33     \n  34     \n  35     def jwt_encod(user):\n  36         jwt_data = {\"id\": user.id,\"login\": user.login}\n  37 >>>     token = jwt.encode(jwt_data, JWT_KEY, algorithm=\"HS256\")\n  38         return token\n  39     \n  40     \n  41     def jwt_decod(token):\n  42         jwt_data = jwt.decode(token, JWT_KEY, algorithms=\"HS256\")",
      "suggested_fix": "Использовать криптостойкие одноразовые токены с истечением, привязкой к пользователю и каналу, проверять владение e-mail/2FA перед сбросом.",
      "poc": "POST /reset?user=<uid>&code=000000 HTTP/1.1\nHost: <host>\nContent-Type: application/x-www-form-urlencoded\n\nnew_password=<masked>",
      "risk": "HIGH: 1 срабатывание HIGH. Возможен захват аккаунта через восстановление.",
      "severity": "HIGH",
      "cwe": "CWE-640 Weak Password Recovery Mechanism for Forgotten Password",
      "sources": [
        "semgrep"
      ]
    },
    {
      "vulnerability": "Hard-coded Secrets in sconfig.py",
      "file": "/taskstate_copy/tsapp/sconfig.py",
      "location": "3-3",
      "original": "   1     import os\n   2     \n   3 >>> SECRET_KEY = 'CTF-2#SecretKey'\n   4     JWT_KEY = 'CTF-2#PirateLabel'\n   5     desteam = [\"External order\", \"Internal order\", \"Technical order\"]\n   6     tstatus = [\"ToDo\",\"Doing\", \"Done\"]\n   7     rteam = [\"Sailor\", \"Corsair\", \"Captain\"]\n   8     ",
      "suggested_fix": "Удалить секреты из репозитория, хранить в переменных окружения/secret manager, настроить ротацию и детекторы утечек.",
      "poc": "curl -H 'Authorization: Bearer <API_KEY>' https://api.example.com/v1/ping",
      "risk": "MEDIUM: 2 срабатывания, секреты в коде. Риск утечки и несанкционированного доступа.",
      "severity": "MEDIUM",
      "cwe": "CWE-798 Use of Hard-coded Credentials",
      "sources": [
        "semgrep"
      ]
    },
    {
      "vulnerability": "Hard-coded Secrets in sconfig.py",
      "file": "/taskstate_copy/tsapp/sconfig.py",
      "location": "4-4",
      "original": "   1     import os\n   2     \n   3     SECRET_KEY = 'CTF-2#SecretKey'\n   4 >>> JWT_KEY = 'CTF-2#PirateLabel'\n   5     desteam = [\"External order\", \"Internal order\", \"Technical order\"]\n   6     tstatus = [\"ToDo\",\"Doing\", \"Done\"]\n   7     rteam = [\"Sailor\", \"Corsair\", \"Captain\"]\n   8     \n   9     ",
      "suggested_fix": "Удалить секреты из репозитория, хранить в переменных окружения/secret manager, настроить ротацию и детекторы утечек.",
      "poc": "curl -H 'Authorization: Bearer <API_KEY>' https://api.example.com/v1/ping",
      "risk": "MEDIUM: 2 срабатывания, секреты в коде. Риск утечки и несанкционированного доступа.",
      "severity": "MEDIUM",
      "cwe": "CWE-798 Use of Hard-coded Credentials",
      "sources": [
        "semgrep"
      ]
    }
  ]
}