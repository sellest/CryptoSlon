{
  "result": [
    {
      "Название": "Code Injection через eval/exec в routes.py",
      "CWE": {
        "id": "CWE-95",
        "name": "Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')"
      },
      "Риск": "HIGH: подтверждено обоими сканерами; возможен удалённый RCE через eval/exec.",
      "ПочемуВажно": "Выполнение произвольного кода ведет к полному компромиссу сервера и данных. Атакующий может выполнить системные команды и закрепиться в инфраструктуре.",
      "PoC": {
        "type": "steps",
        "value": "1) Найдите обработчик с параметром cmd (routes.py:217). 2) Отправьте запрос с payload типа <payload> вызывающим код. 3) Убедитесь, что код выполняется (побочный эффект/ответ)."
      },
      "Fix": "Исключить eval/exec. Использовать белые списки допустимых операций/команд или безопасные маппинги; валидировать и санитизировать ввод.",
      "RepresentativeEvidence": [
        {
          "file": "/taskstate_2/tsapp/routes.py",
          "start_line": 217,
          "end_line": 217,
          "snippet": "cmd = request.args.get('cmd')\nres = eval(cmd)"
        }
      ],
      "Источник": "both",
      "Подсчёт": {
        "severity": "HIGH",
        "instances": 4
      }
    },
    {
      "Название": "Хардкод секретов и паролей (routes.py, sconfig.py)",
      "CWE": {
        "id": "CWE-798/259",
        "name": "Use of Hard-coded Credentials / Use of Hard-coded Password"
      },
      "Риск": "MEDIUM: подтверждено обоими; утечка ключей/паролей упрощает компромисс сервисов.",
      "ПочемуВажно": "Компрометированные секреты позволяют неавторизованный доступ к БД, API и облаку. Секреты часто попадают в логи и репозитории и используются повторно.",
      "PoC": {
        "type": "steps",
        "value": "1) Просмотрите sconfig.py:3-4 и routes.py отметки в отчёте. 2) Увидьте значения вида API_KEY='<token>' или пароль. 3) Проверьте что ключи действительны, не раскрывая <token>."
      },
      "Fix": "Удалить секреты из кода; хранить в переменных окружения/Secret Manager. Провести немедленную ротацию ключей/паролей.",
      "RepresentativeEvidence": [
        {
          "file": "/taskstate_2/tsapp/sconfig.py",
          "start_line": 3,
          "end_line": 4,
          "snippet": "API_KEY = \"sk-<redacted>\"\nDB_PASSWORD = \"<redacted>\""
        }
      ],
      "Источник": "both",
      "Подсчёт": {
        "severity": "MEDIUM",
        "instances": 9
      }
    },
    {
      "Название": "Неправильное управление привилегиями (множество эндпойнтов)",
      "CWE": {
        "id": "CWE-269",
        "name": "Improper Privilege Management"
      },
      "Риск": "HIGH: множество срабатываний; проверки ролей/доступа отсутствуют или обходятся.",
      "ПочемуВажно": "Повышение привилегий даёт доступ к административным действиям и чувствительным данным. Это приводит к подмене ролей, изменению состояний и утечкам.",
      "PoC": {
        "type": "steps",
        "value": "1) Откройте эндпойнт из routes.py:416-429. 2) Обратитесь к нему как обычный пользователь. 3) Проверьте, что действие админа выполнилось без корректной проверки роли."
      },
      "Fix": "Ввести централизованные проверки RBAC/ABAC и обязательные декораторы @login_required/@roles_required на админ-ручках.",
      "RepresentativeEvidence": [
        {
          "file": "/taskstate_2/tsapp/routes.py",
          "start_line": 416,
          "end_line": 429,
          "snippet": "if request.args.get('is_admin') == '1':\n    current_user.role = 'admin'\n# отсутствует строгая проверка прав\nadmin_action()"
        }
      ],
      "Источник": "semgrep",
      "Подсчёт": {
        "severity": "HIGH",
        "instances": 21
      }
    },
    {
      "Название": "Слабое восстановление пароля / токен-ресет",
      "CWE": {
        "id": "CWE-640",
        "name": "Weak Password Recovery Mechanism for Forgotten Password"
      },
      "Риск": "HIGH: токены/процесс восстановления предсказуемы или без верификации личности.",
      "ПочемуВажно": "Злоумышленник может перехватить или угадать токен и сменить пароль жертвы. Это приводит к захвату аккаунтов и эскалации доступа.",
      "PoC": {
        "type": "steps",
        "value": "1) Инициируйте reset и получите ссылку с token. 2) Попробуйте короткие/последовательные значения token на routes.py:120-196. 3) Подтвердите смену пароля без доп. проверки."
      },
      "Fix": "Использовать криптосильно сгенерированные одноразовые токены, строгую валидацию личности, TTL и rate limit.",
      "RepresentativeEvidence": [
        {
          "file": "/taskstate_2/tsapp/routes.py",
          "start_line": 120,
          "end_line": 130,
          "snippet": "token = request.args.get('token')  # слабый/короткий\nuser = get_user_by_email(request.args['email'])\nreset_password(user, request.args['new'])"
        }
      ],
      "Источник": "semgrep",
      "Подсчёт": {
        "severity": "HIGH",
        "instances": 2
      }
    },
    {
      "Название": "Server-Side Template Injection (SSTI) в routes.py",
      "CWE": {
        "id": "CWE-1336",
        "name": "Improper Neutralization of Special Elements Used in a Template Engine"
      },
      "Риск": "HIGH: внедрение выражений в шаблон может привести к RCE в некоторых движках.",
      "ПочемуВажно": "SSTI часто эскалируется в выполнение кода через объекты шаблонизатора. Это компрометирует сервер и данные.",
      "PoC": {
        "type": "http",
        "value": "GET /endpoint?name={{7*7}}  — ожидаемый ответ содержит 49, что указывает на SSTI."
      },
      "Fix": "Не передавать необработанный ввод в render_template_string; использовать строгую подстановку и автоэкранирование.",
      "RepresentativeEvidence": [
        {
          "file": "/taskstate_2/tsapp/routes.py",
          "start_line": 405,
          "end_line": 405,
          "snippet": "name = request.args.get('name')\nreturn render_template_string(\"Hello \" + name)"
        }
      ],
      "Источник": "semgrep",
      "Подсчёт": {
        "severity": "HIGH",
        "instances": 1
      }
    }
  ],
  "verdict": {
    "summary": "Главные риски: подтверждённые обоими инструментами Code Injection и утечки секретов, а также масштабные проблемы с привилегиями. Требуются немедленные исправления.",
    "totals": {
      "all_findings": 42,
      "root_vulns": 5,
      "confirmed_both": 2,
      "semgrep_only": 3,
      "bandit_only": 0
    },
    "cwe_list": [
      "CWE-95",
      "CWE-259",
      "CWE-798",
      "CWE-269",
      "CWE-640",
      "CWE-1336",
      "CWE-532"
    ]
  },
  "metadata": {
    "model": "gpt-5",
    "template": "sast",
    "source_report": "/Users/izelikson/python/CryptoSlon/SAST/reports/test_4/aggregated_report.json",
    "is_json": true
  }
}