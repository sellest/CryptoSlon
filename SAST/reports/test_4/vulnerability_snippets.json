{
  "metadata": {
    "source_report": "/Users/izelikson/python/CryptoSlon/SAST/reports/test_4/triage_analysis.json",
    "code_base_path": "/Users/izelikson/python/CryptoSlon/SAST/code_for_sast/taskstate_2",
    "generated_at": "2025-08-24T00:00:00Z",
    "total_snippets": 6
  },
  "vulnerabilities": [
    {
      "vulnerability": "Небезопасная динамическая оценка кода (eval/exec)",
      "file": "/taskstate_2/tsapp/routes.py",
      "location": "217-217",
      "original": " 212     \n 213     @app.route('/taskcreate', methods=['POST'])\n 214     @login_required\n 215     def taskcreate():\n 216         if request.method == \"POST\":\n 217 >>>         if (len(request.form['title']) > 2 and type(int(request.form['did'])) == int and type(eval(request.form['private'])) == bool):\n 218                 task = TS_Task(did=int(request.form['did']), title=request.form['title'], description=request.form['description'], private=eval(request.form['private']), uid1=current_user.id, uid2=-1)\n 219                 try:\n 220                     db.session.add(task)\n 221                     db.session.commit()\n 222                     app.logger.info('[FUNC] [/taskcreate] [Succeess] User:<%s> Title:<%s> Description:<%s>',current_user.login, task.title, task.description)",
      "suggested_fix": "Уберите eval/exec. Реализуйте явный маппинг допустимых операций или используйте безопасный парсер (например, ast.literal_eval) и строгую валидацию.",
      "poc": "1) Найдите эндпоинт, использующий параметр expr (routes.py:216-232). 2) Отправьте GET /<path>?expr=2*3 и проверьте ответ 6. 3) Затем попробуйте expr=__import__('os').popen('<cmd>').read() с безопасной <cmd> для подтверждения.",
      "risk": "HIGH: может привести к удаленному выполнению кода и полному компромиссу сервера",
      "severity": "HIGH",
      "cwe": "CWE-95 Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')",
      "sources": [
        "both"
      ]
    },
    {
      "vulnerability": "Хардкоденные секреты и пароли в коде",
      "file": "/taskstate_2/tsapp/sconfig.py",
      "location": "3-3",
      "original": "   1     import os\n   2     \n   3 >>> SECRET_KEY = 'CTF-2#SecretKey'\n   4     JWT_KEY = 'CTF-2#PirateLabel'\n   5     desteam = [\"External order\", \"Internal order\", \"Technical order\"]\n   6     tstatus = [\"ToDo\",\"Doing\", \"Done\"]\n   7     rteam = [\"Sailor\", \"Corsair\", \"Captain\"]\n   8     ",
      "suggested_fix": "Удалите секреты из кода, храните в переменных окружения/secret manager, выполните немедленную ротировку скомпрометированных ключей.",
      "poc": "Проверьте /tsapp/sconfig.py:3-4 и упомянутые строки в routes.py на наличие шаблона (SECRET|PASSWORD|API|TOKEN)\\s*=\\s*\"<...>\". Подтвердите, что значения работоспособны, не раскрывая их.",
      "risk": "HIGH: утечка ключей/паролей ведет к несанкционированному доступу к сервисам",
      "severity": "MEDIUM",
      "cwe": "CWE-798 Use of Hard-coded Credentials",
      "sources": [
        "both"
      ]
    },
    {
      "vulnerability": "Хардкоденные секреты и пароли в коде",
      "file": "/taskstate_2/tsapp/sconfig.py",
      "location": "4-4",
      "original": "   1     import os\n   2     \n   3     SECRET_KEY = 'CTF-2#SecretKey'\n   4 >>> JWT_KEY = 'CTF-2#PirateLabel'\n   5     desteam = [\"External order\", \"Internal order\", \"Technical order\"]\n   6     tstatus = [\"ToDo\",\"Doing\", \"Done\"]\n   7     rteam = [\"Sailor\", \"Corsair\", \"Captain\"]\n   8     \n   9     ",
      "suggested_fix": "Удалите секреты из кода, храните в переменных окружения/secret manager, выполните немедленную ротировку скомпрометированных ключей.",
      "poc": "Проверьте /tsapp/sconfig.py:3-4 и упомянутые строки в routes.py на наличие шаблона (SECRET|PASSWORD|API|TOKEN)\\s*=\\s*\"<...>\". Подтвердите, что значения работоспособны, не раскрывая их.",
      "risk": "HIGH: утечка ключей/паролей ведет к несанкционированному доступу к сервисам",
      "severity": "MEDIUM",
      "cwe": "CWE-798 Use of Hard-coded Credentials",
      "sources": [
        "both"
      ]
    },
    {
      "vulnerability": "Неправильное управление привилегиями и доступом",
      "file": "/taskstate_2/tsapp/routes.py",
      "location": "416-429",
      "original": " 411     @login_required\n 412     def adm():\n 413         reg = 0\n 414         rid = f_rid_get(request)\n 415         page = request.args.get(get_page_parameter(), type=int, default=1)\n 416 >>>     if rid == 2:\n 417 >>>         users = TS_User.query.order_by(TS_User.id.desc()).paginate(page=page, per_page=10)\n 418 >>>         pagination = Pagination(page=page, total=users.total, record_name='users')\n 419 >>>         app.logger.info('[FUNC] [/adminpanel] [Succeess] User:<%s> Role:<%d>/<%d> Read users: <%d>', current_user.login, current_user.rid, rid, len(users.items))\n 420 >>>         return render_template(\"admpanel.html\", users=users, rteam=rteam, reg=reg, pagination=pagination)\n 421 >>>     else:\n 422 >>>         users = TS_User.query.filter(TS_User.rid==2).order_by(TS_User.id.desc()).all()\n 423 >>>         if len(users) == 0:\n 424 >>>             reg = 1\n 425 >>>             app.logger.info('[FUNC] [/adminpanel] [Succeess] User:<%s> Role:<%d>/<%d> Start initialization >> Registration of a new captain for the service', current_user.login, current_user.rid, rid)\n 426 >>>             return render_template(\"admpanel.html\", users=users, rteam=rteam, reg=reg)\n 427 >>>         else:\n 428 >>>             app.logger.warning('[FUNC] [/adminpanel] [Failed] User:<%s> Access is denied', current_user.login)\n 429 >>>             return redirect(url_for('index'))\n 430     \n 431     \n 432     @app.route('/adm/<int:id>/nrteam')\n 433     @login_required\n 434     def adm_nrteam(id):",
      "suggested_fix": "Добавьте централизованные проверки авторизации: @login_required, проверка роли/владения и policy-based access control на каждом чувствительном маршруте.",
      "poc": "Войдите обычным пользователем. Вызовите админ-эндпоинты около routes.py:416-429 и 458-473. Если операции проходят (HTTP 200) без проверки роли/владения, эскалация подтверждена.",
      "risk": "HIGH: отсутствие проверок ролей/владения открывает путь к повышению привилегий",
      "severity": "HIGH",
      "cwe": "CWE-269 Improper Privilege Management",
      "sources": [
        "semgrep"
      ]
    },
    {
      "vulnerability": "Слабый механизм восстановления пароля",
      "file": "/taskstate_2/tsapp/func.py",
      "location": "37-37",
      "original": "  32         return res\n  33     \n  34     \n  35     def jwt_encod(user):\n  36         jwt_data = {\"id\": user.id,\"login\": user.login}\n  37 >>>     token = jwt.encode(jwt_data, JWT_KEY, algorithm=\"HS256\")\n  38         return token\n  39     \n  40     \n  41     def jwt_decod(token):\n  42         jwt_data = jwt.decode(token, JWT_KEY, algorithms=\"HS256\")",
      "suggested_fix": "Используйте криптографически стойкие, подписанные HMAC/JWT токены, одноразовые и с TTL; строго проверяйте перед сбросом пароля.",
      "poc": "Запросите восстановление пароля. Перехватите ссылку и измените/подберите token, повторно используйте через время. Если сброс успешен без проверки подписи/срока, уязвимость подтверждена.",
      "risk": "HIGH: предсказуемые/неподписанные токены позволяют перехватить сброс пароля",
      "severity": "HIGH",
      "cwe": "CWE-640 Weak Password Recovery Mechanism for Forgotten Password",
      "sources": [
        "semgrep"
      ]
    },
    {
      "vulnerability": "Server-Side Template Injection (SSTI)",
      "file": "/taskstate_2/tsapp/routes.py",
      "location": "405-405",
      "original": " 400             if rid == 1:\n 401                 tasks = TS_Task.query.filter(and_(or_(TS_Task.private==False, and_(TS_Task.uid1==current_user.id, TS_Task.private==True)), TS_Task.title.contains(tsearch))).order_by(TS_Task.date.desc()).all()\n 402             if rid == 0:\n 403                 tasks = TS_Task.query.filter(and_(TS_Task.uid1==current_user.id, TS_Task.title.contains(tsearch))).order_by(TS_Task.date.desc()).all()\n 404             app.logger.info('[FUNC] [/search] [Succeess] User:<%s> Role:<%d> Data:<%s>',current_user.login, rid, tsearch)\n 405 >>>         return render_template(\"searchlist.html\", tasks=tasks, tstatus=tstatus, tsearch=render_template_string(tsearch))\n 406         else:\n 407             return redirect(url_for('index'))\n 408     \n 409     \n 410     @app.route('/adm')",
      "suggested_fix": "Не передавайте непроверенный ввод в шаблоны; экранируйте значения, используйте безопасные фильтры и строгий allowlist переменных.",
      "poc": "GET /<path>?name={{7*7}} и проверьте, что ответ содержит 49 (routes.py:405). Не используйте опасные полезные нагрузки; тестируйте в изоляции.",
      "risk": "HIGH: выполнение выражений в шаблоне может привести к RCE через шаблонизатор",
      "severity": "HIGH",
      "cwe": "CWE-1336 Improper Neutralization of Special Elements Used in a Template Engine",
      "sources": [
        "semgrep"
      ]
    }
  ]
}