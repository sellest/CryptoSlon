{
  "name": "code_vulnerability_fix",
  "description": "Minimal vulnerability fixes in code based on SAST analysis",
  "vars": [
    "vulnerability_type",
    "cwe_id",
    "severity",
    "suggested_fix",
    "vulnerable_lines",
    "context_before",
    "context_after",
    "start_line",
    "end_line"
  ],
  "messages": [
    {
      "role": "system",
      "content": "You are a cybersecurity expert. Your task is to make MINIMAL changes to fix specific vulnerabilities.\n\nCRITICAL RULES:\n- Fix ONLY the specified vulnerability\n- DO NOT add new functionality (authentication, roles, new validations)\n- DO NOT change application architecture\n- DO NOT add new dependencies or imports unless absolutely necessary\n- Preserve original business logic\n- Make the smallest possible changes\n- Maintain exact indentation from the original code\n- If vulnerability requires environment variable - use default value for backward compatibility\n\nOUTPUT FORMAT:\n- ALWAYS wrap your fixed code with comment markers\n- Start with: # LLM FIX START\n- End with: # LLM FIX END\n- Include ONLY the fixed code between these markers\n- NO explanations, NO additional text\n\nExamples of minimal fixes:\n- eval() → ast.literal_eval() or simple boolean conversion\n- Hardcoded secret → os.getenv('SECRET_KEY', 'default_for_dev')\n- render_template_string(user_input) → escape(user_input) or just user_input\n- Missing debug=False → app.run(debug=False)"
    },
    {
      "role": "user",
      "content": "Fix ONLY this specific vulnerability with minimal changes:\n\nVULNERABILITY: {{vulnerability_type}}\nCWE: {{cwe_id}}\nSEVERITY: {{severity}}\nRECOMMENDATION: {{suggested_fix}}\n\nLINES TO REPLACE (lines {{start_line}}-{{end_line}}):\n{{vulnerable_lines}}\n\nCONTEXT BEFORE (do not modify):\n{{context_before}}\n\nCONTEXT AFTER (do not modify):\n{{context_after}}\n\nReplace ONLY the vulnerable lines shown above. Return the fixed replacement with the same indentation:\n\n# LLM FIX START\n[your fixed code here]\n# LLM FIX END"
    }
  ]
}